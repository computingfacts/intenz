<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF8" />
<script src="../dbdoc.js" type="text/javascript"></script>
<link href="../dbdoc.css" type="text/css" rel="stylesheet">
</head>
<body class="object">
<div id="header"><h2>P_CLONE_ENZYME</h2>
<div class="tabs clearfix">

<div class="tab"><div><a href="P_CLONE_ENZYME.html">Details</a></div></div>
<div class="tab"><div><a href="P_CLONE_ENZYME_Grants.html">Grants</a></div></div>
<div class="tab"><div><a href="P_CLONE_ENZYME_References.html">References</a></div></div>
<div class="tab"><div><a href="P_CLONE_ENZYME_Dependencies.html">Dependencies</a></div></div>
<div class="tab" id="current"><div><a href="P_CLONE_ENZYME_Code.html">Code</a></div></div>
</div></div><br/>
<div class="tab-panes">
<div id="Code"> <table cellpadding="0" cellspacing="0" cellspacing="0" summary=""><tr>
	<th>TEXT</th>
</tr>
	<tr><td><pre>
PROCEDURE p_clone_enzyme (
  old_enzyme_id IN  enzymes.enzyme_id%type,
  new_enzyme_id OUT enzymes.enzyme_id%type,
  new_status    IN  enzymes.status%type DEFAULT 'SC',
  new_active    IN  enzymes.active%type DEFAULT 'N'
)
AS
  enz_a enzymes%rowtype;
BEGIN
  /* lock affected tables to be transaction save */
  LOCK TABLE enzymes   		IN EXCLUSIVE MODE;
  LOCK TABLE names     		IN EXCLUSIVE MODE;
  LOCK TABLE reactions_map	IN EXCLUSIVE MODE;
  LOCK TABLE comments  		IN EXCLUSIVE MODE;
  LOCK TABLE xrefs     		IN EXCLUSIVE MODE;
  LOCK TABLE links     		IN EXCLUSIVE MODE;

  /* get source enzyme */
  BEGIN
    SELECT *
      INTO enz_a
      FROM enzymes
     WHERE enzyme_id = old_enzyme_id;
  EXCEPTION
    WHEN NO_DATA_FOUND THEN
    RAISE_APPLICATION_ERROR(-20000, 'source enzyme not found');
  END;

  /* get new enzyme_id */
  SELECT s_enzyme_id.nextval
    INTO new_enzyme_id
    FROM DUAL;
  --DBMS_OUTPUT.PUT_LINE('got new enzyme_id='||new_enzyme_id);

  /*  clone enzyme */
  INSERT INTO enzymes
         (enzyme_id, status, active,
          ec1, ec2, ec3, ec4,
          history, note, source)
  VALUES (new_enzyme_id, new_status, new_active,
          enz_a.ec1, enz_a.ec2, enz_a.ec3, enz_a.ec4,
          enz_a.history, enz_a.note, enz_a.source);
  --DBMS_OUTPUT.PUT_LINE('Done enzymes');

  /* clone names*/
  INSERT INTO names (
         enzyme_id, status,
         name, name_class, warning, source, note, order_in, web_view)
  SELECT new_enzyme_id, new_status,
         name, name_class, warning, source, note, order_in, web_view
    FROM names
   WHERE enzyme_id = old_enzyme_id;
  --DBMS_OUTPUT.PUT_LINE('Done names');

  /* clone reactions mapping */
  INSERT INTO reactions_map (enzyme_id, reaction_id, web_view, order_in)
  SELECT new_enzyme_id, reaction_id, web_view, order_in
    FROM reactions_map
   WHERE enzyme_id = old_enzyme_id;

  /* clone abstract (free text) reactions */
  INSERT INTO reactions (enzyme_id, equation, order_in, status, source, web_view)
  SELECT new_enzyme_id, equation, order_in, status, source, web_view
    FROM reactions
   WHERE enzyme_id = old_enzyme_id;
  --DBMS_OUTPUT.PUT_LINE('Done reactions');

  /* clone comments */
  INSERT INTO comments (
         enzyme_id, status,
         comment_text, order_in, source, web_view)
  SELECT new_enzyme_id, new_status,
         comment_text, order_in, source, web_view
    FROM comments
   WHERE enzyme_id = old_enzyme_id;
  --DBMS_OUTPUT.PUT_LINE('Done comments');

  /* clone xrefs */
  INSERT INTO xrefs (
         enzyme_id, status,
         database_code, database_ac, name, source, data_comment, web_view)
  SELECT new_enzyme_id, new_status,
         database_code, database_ac, name, source, data_comment, web_view
    FROM xrefs
   WHERE enzyme_id = old_enzyme_id;
  --DBMS_OUTPUT.PUT_LINE('Done xrefs');

  /* clone links */
  INSERT INTO links (
         enzyme_id, status,
         url, display_name, source, data_comment, web_view)
  SELECT new_enzyme_id, new_status,
         url, display_name, source, data_comment, web_view
    FROM links
   WHERE enzyme_id = old_enzyme_id;
  --DBMS_OUTPUT.PUT_LINE('Done links');

  /* clone citations */
  INSERT INTO citations (
         enzyme_id, status,
         pub_id, order_in, source)
  SELECT new_enzyme_id, new_status,
         pub_id, order_in, source
    FROM citations
   WHERE enzyme_id = old_enzyme_id;
  --DBMS_OUTPUT.PUT_LINE('Done citations');

END;</pre>	</td></tr>
</table></div>